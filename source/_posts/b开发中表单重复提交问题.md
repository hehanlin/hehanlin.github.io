title: web开发中表单重复提交问题
author: hanlin
tags: []
categories: []
date: 2016-01-28 19:00:00
---
### 1. 场景一（多次点击按钮提交表单）
如果网速比较慢的情况下，用户提交表单后，发现服务器半天都没有响应，那么用户可能会以为是自己没有提交表单，就会再点击提交按钮重复提交表单。面对这个情况，如果只是在jsp页面，加上js判断的代码
<!--more-->
```
var checkSubmitFlg = false;

 function check(){

     if (checkSubmitFlg == true){

            alert("重复提交");

            return;

       }else{

    checkSubmitFlg = true;   

    myform.submit();

     }

 }
```
JavaScript是可以解决这个问题的，当然还可以"用JavaScript控制Form表单只能提交一次"。只是点提交按钮后让按钮变灰类似手机端的做法。但是这种做法针对以下2,3场景确不行。

### 2. 场景二 （点刷新）    场景三（点后退）

场景二表单提交后用户点击【刷新】按钮导致表单重复提交 和 场景三用户提交表单后，点击浏览器的【后退】按钮回退到表单页面后进行再次提交，用户这样的操作为了解决重复提交表单的问题，我们可以在服务端利用session去解决。

具体的做法：在服务器端生成一个唯一的随机标识号，专业术语称为Token(令牌)，同时在当前用户的Session域中保存这个Token。然后将Token发送到客户端的Form表单中，在Form表单中使用隐藏域来存储这个Token，表单提交的时候连同这个Token一起提交到服务器端，然后在服务器端判断客户端提交上来的Token与服务器端生成的Token是否一致，如果不一致，那就是重复提交了，此时服务器端就可以不处理重复提交的表单。如果相同则处理表单提交，处理完后清除当前用户的Session域中存储的标识号。

在下列情况下，服务器程序将拒绝处理用户提交的表单请求：

>存储Session域中的Token(令牌)与表单提交的Token(令牌)不同。
当前用户的Session中不存在Token(令牌)。
用户提交的表单数据中没有Token(令牌)。